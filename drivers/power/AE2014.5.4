/*****************************************************************************
* Copyright(c) O2Micro, 2013. All rights reserved.
*	
* O2Micro OZ8806 battery gauge driver
* File: parameter.c

* Author: Eason.yuan
* $Source: /data/code/CVS
* $Revision: 4.00.01 $
*
* This program is free software and can be edistributed and/or modify
* it under the terms of the GNU General Public License version 2 as
* published by the Free Software Foundation.
*	
* This Source Code Reference Design for O2MICRO OZ8806 access (\u201cReference Design\u201d) 
* is sole for the use of PRODUCT INTEGRATION REFERENCE ONLY, and contains confidential 
* and privileged information of O2Micro International Limited. O2Micro shall have no 
* liability to any PARTY FOR THE RELIABILITY, SERVICEABILITY FOR THE RESULT OF PRODUCT 
* INTEGRATION, or results from: (i) any modification or attempted modification of the 
* Reference Design by any party, or (ii) the combination, operation or use of the 
* Reference Design with non-O2Micro Reference Design.
*****************************************************************************/

#include <linux/kernel.h>
#include <linux/module.h>
#include <linux/i2c.h>
#include "parameter.h"

/*****************************************************************************
* Define section
* add all #define here
*****************************************************************************/
//#define OCV_DATA_NUM  11


/****************************************************************************
* extern variable declaration section
****************************************************************************/
extern int32_t res_divider_ratio;
extern uint8_t oz8806_cell_num;

/*****************************************************************************
* Global variables section - Exported
* add declaration of global variables that will be exported here
* e.g.
*	int8_t foo;
****************************************************************************/

one_latitude_data_t ocv_data[OCV_DATA_NUM] = {
	{3400, 00},{3500, 0}, {3668, 5}, {3700, 12},{3716, 15},{3732, 17},{3748, 19},
	{3764, 22},{3780, 27},{3796, 35},{3812, 40},{3828, 44},{3844, 47},{3860, 50},
	{3876, 53},{3892, 55},{3908, 56},{3924, 58},{3940, 60},{3956, 62},{3972, 64},
	{3988, 66},{4004, 68},{4020, 69},{4036, 71},{4052, 72},{4068, 74},{4084, 76},
	{4100, 77},{4116, 79},{4132, 80},{4148, 82},{4164, 83},{4180, 85},{4196, 86},
	{4212, 88},{4235, 90},{4240, 92},{4250, 93},{4260, 95},{4270, 96},{4280, 98},
	{4290, 99},{4300, 100},
};

// changle
one_latitude_data_t	charge_data[CHARGE_DATA_NUM] = {                                                                                                               
	{100, 10000},{158, 9989},{163, 9988},{169, 9987},{172, 9986},{178, 9965},{183,9943},
	{189, 9921},{198, 9882},{201, 9873},{207, 9847},{213, 9825},{219, 9803},{225, 9777},
	{233, 9747},{239, 9725},{247, 9694},{254, 9668},{262, 9638},{269, 9612},{278, 9577},
	{295, 9507},{313, 9429},{333, 9410},{353,9409},{375, 9400},{399, 9380},{424, 9350},
	{450, 9259},{479, 9163},{509, 9063},{539, 8967},{556, 8910},{574, 8854},{590, 8801},
	{626, 8684},{665, 8557},{706, 8409},{749, 8350},{770, 8300},{794, 8280},{816, 8250},
	{840, 8248},{864, 8174},{889, 8091},{914, 8013},{938, 7943},{965, 7856},{991, 7747},
	{1018, 7686},{1044, 7599},
};


one_latitude_data_t			cell_temp_data[TEMPERATURE_DATA_NUM] = {                                                                                                               
			{681,   115}, {766,   113}, {865,   105},
			{980,   100}, {1113,   95}, {1266,   90},
			{1451,   85}, {1668,   80}, {1924,   75},
			{2228,   70}, {2588,   65}, {3020,   60},
			{3536,   55}, {4160,   50}, {4911,   45},
			{5827,   40}, {6940,   35}, {8313,   30},
			{10000,  25}, {12090,  20}, {14690,  15},
			{17960,  10}, {22050,   5},	{27280,   0},
			{33900,  -5}, {42470, -10}, {53410, -15},
			{67770, -20},
};


config_data_t config_data = {20,232000,3300,5,781,250,3050,4350,160,3500,0,1};
//config_data_t config_data = {20,232000,3300,5,781,250,6850,4200,100,3500,0,1};

//
//config_data_t config_data = {22,232000,3300,5,781,250,6858,2100,100,1750,0,1};

/*
	int32_t		fRsense;		//= 20;			//Rsense value of chip, in mini ohm
	int32_t     temp_pull_up;  //230000;
	int32_t     temp_ref_voltage; //1800;1.8v
	int32_t		dbCARLSB;		//= 5.0;		//LSB of CAR, comes from spec
	int32_t		dbCurrLSB;		//781 (3.90625*100);	//LSB of Current, comes from spec
	int32_t		fVoltLSB;		//250 (2.5*100);	//LSB of Voltage, comes from spec

	int32_t		design_capacity;	//= 7000;		//design capacity of the battery
 	int32_t		charge_cv_voltage;	//= 4200;		//CV Voltage at fully charged
	int32_t		charge_end_current;	//= 100;		//the current threshold of End of Charged
	int32_t		discharge_end_voltage;	//= 3550;		//mV
	int32_t     board_offset;			//0; 				//mA, not more than caculate data
	uint8_t     debug;                                          // enable or disable O2MICRO debug information
}
*/



//  
int	XAxisElement[XAxis] = {3300,3320,3370,3395,3440,3465,3490,3510,3530,3555,3580,3605,
							3615,3645,3670,3700,3735,3775,3830,3920,3960,4035,4130,4205,4300};	
 

//int	YAxisElement[YAxis] = { 150,300,800,1000,1500,1600};	//real current mA.
//int	YAxisElement[YAxis] = { 167,334,835,1336,1670,2004};	//real current mA for huawei.
int	YAxisElement[YAxis] = { 214,397,610,793,1007,1312,1586};

                  
// RC table Z Axis value, in 10*'C format
int	ZAxisElement[ZAxis] = { -75,-25,50,150,250,350,450,550};

// contents of RC table, its unit is 10000C, 1C = DesignCapacity
int	RCtable[YAxis*ZAxis][XAxis]={
//temp = -7.5 ^C

{757,857,1348,1584,2111,2237,2382,2812,3585,4485,5465,6037,6136,6578,6630,6816,7116,7856,8504,9276,9240,9316,9655,10000,10000},
{1512,1795,2707,3173,4370,4977,5711,6211,6515,7123,7617,8621,8824,9100,9282,8927,9419,9642,9876,9670,10000,10000,10000,10000,10000},
{3706,4300,6483,7665,9678,10000,10000,10000,10000,10000,10000,10000,10000,10000,10000,10000,10000,10000,10000,10000,10000,10000,10000,10000,10000},
{6866,7418,8674,9511,10000,10000,10000,10000,10000,10000,10000,10000,10000,10000,10000,10000,10000,10000,10000,10000,10000,10000,10000,10000} ,           
{10000,10000,10000,10000,10000,10000,10000,10000,10000,10000,10000,10000,10000,10000,10000,10000,10000,10000,10000,10000,10000,10000,10000,10000,10000},
{10000,10000,10000,10000,10000,10000,10000,10000,10000,10000,10000,10000,10000,10000,10000,10000,10000,10000,10000,10000,10000,10000,10000,10000,10000},
{10000,10000,10000,10000,10000,10000,10000,10000,10000,10000,10000,10000,10000,10000,10000,10000,10000,10000,10000,10000,10000,10000,10000,10000,10000},

//temp = -2.5 ^C

{648,710,1009,1149,1459,1556,1671,1977,2519,3103,3737,4099,4219,4722,5009,5401,5792,6607,7382,8265,8418,8811,9340,9971,10000},
{1200,1362,1889,2170,2787,3136,3533,3854,4105,4600,5192,5918,6079,6523,6929,7141,7599,8066,8395,8683,9048,9561,10000,10000,10000},	
{2521,2872,4109,4768,5958,6793,6816,6986,7008,7056,8058,8530,8604,8618,8348,8254,8277,8623,9070,9748,10000,10000,10000,10000,10000},	
{4382,4757,5641,6246,7348,8050,8873,8897,9059,9087,8977,8977,8926,8856,8778,8891,8940,9182,9588,10000,10000,10000,10000,10000,10000},	
{6772,7230,8238,9062,9266,9548,9120,9210,9506,9520,9530,9560,9580,9600,9620,9630,9700,9890,10000,10000,10000,10000,10000,10000,10000},	
{8347,8918,10000,10000,10000,10000,10000,10000,10000,10000,10000,10000,10000,10000,10000,10000,10000,10000,10000,10000,10000,10000,10000,10000,10000},	
{10000,10000,10000,10000,10000,10000,10000,10000,10000,10000,10000,10000,10000,10000,10000,10000,10000,10000,10000,10000,10000,10000,10000,10000,10000},


//temp = 5 ^C

{526,551,681,744,886,961,1053,1257,1602,1924,2274,2465,2596,3132,3607,4169,4637,5520,6419,7423,7712,8345,9029,9708,10000},
{837,914,1163,1301,1594,1785,2004,2207,2421,2791,3241,3742,3900,4436,4986,5501,6090,6652,7207,7878,8219,8843,9579,10000,10000},
{1462,1622,2151,2427,3018,3449,3658,3879,4148,4490,5244,5762,5919,6273,6437,6663,6945,7375,7902,8608,8929,9411,10000,10000,10000},	
{2307,2518,3045,3423,4171,4671,5230,5461,5820,6159,6416,6685,6741,6965,7107,7361,7597,7933,8398,9018,9347,9913,10000,10000,10000},	
{3299,3568,4266,4779,5378,5776,5919,6221,6567,7005,7284,7903,7690,7601,7689,7943,8194,8471,8881,9550,9778,10000,10000,10000,10000},	
{4736,5123,6208,6705,7474,7976,8441,8363,8272,8100,8217,8326,8379,8589,8755,8959,9187,9447,9820,10000,10000,10000,10000,10000,10000},	
{6842,7229,8237,8734,9213,9369,9244,9117,9213,9054,9250,9451,9681,9680,9624,9900,10000,10000,10000,10000,10000,10000,10000,10000,10000},	


//temp = 15 ^C

{419,418,446,466,524,589,669,813,1043,1212,1398,1492,1625,2164,2743,3402,3916,4844,5832,6931,7282,8033,8799,9501,9902},
{550,572,652,706,817,920,1038,1172,1353,1630,1974,2314,2456,3018,3638,4336,5037,5687,6423,7370,7705,8393,9203,9800,10000},
{779,837,1021,1115,1420,1663,1915,2120,2421,2779,3261,3742,3941,4496,4964,5435,5917,6432,7062,7874,8245,8867,9599,9955,10000},
{1087,1188,1466,1683,2129,2453,2793,3027,3413,3834,4267,4689,4819,5272,5607,6016,6447,6901,7466,8238,8577,9177,9856,10000,10000},
{1381,1504,1917,2167,2752,3107,3485,3847,4171,4576,4936,5306,5433,5825,6150,6508,6906,7307,7799,8563,8878,9421,9940,10000,10000},
{2405,2637,3257,3560,4242,4592,4989,5219,5522,5734,6125,6413,6536,6854,7128,7413,7713,8074,8541,9210,9464,9834,10000,10000,10000},
{3709,3959,4655,5031,5624,5892,6235,6442,6661,6895,7166,7444,7540,7787,8036,8268,8568,8862,9244,9770,9900,10000,10000,10000,10000},
                                                                                                        

//temp = 25 ^C

{413,419,445,459,506,537,580,638,718,719,822,1122,1258,1611,2063,2961,3619,4639,5615,6696,7112,7909,8704,9436,9959},
{455,472,523,553,614,654,701,745,803,925,1194,1697,1831,2204,2679,3650,4542,5318,6095,7111,7498,8223,9057,9686,10000},
{501,522,586,625,713,782,876,993,1160,1456,1857,2191,2353,3055,3768,4449,5124,5751,6451,7415,7772,8467,9278,9865,10000},
{613,641,729,789,946,1088,1299,1510,1804,2174,2552,3134,3380,4105,4619,5115,5668,6211,6876,7733,8107,8745,9509,9970,10000},
{748,801,989,1140,1541,1859,2194,2569,2974,3531,4056,4537,4735,5199,5581,6010,6447,6917,7469,8291,8639,9257,9925,10000,10000},
{1343,1513,2145,2575,3379,3925,4471,4851,5135,5496,5821,6170,6336,6679,6946,7262,7597,8021,8475,9173,9724,9986,10000,10000,10000},
{2036,2310,3201,3671,4416,4831,5216,5507,5784,6095,6419,6699,6815,7150,7403,7679,7989,8342,8796,9492,9771,9993,10000,10000,10000},
                                                                                 

//temp = 35 ^C

{371,374,388,399,442,473,516,564,628,606,687,974,1108,1455,1919,2831,3496,4524,5520,6624,7042,7845,8646,9374,9897},	
{370,378,407,427,468,497,531,566,614,713,956,1422,1547,1907,2383,3380,4308,5115,5942,7022,7412,8145,8981,9607,9911},
{374,387,426,451,517,572,654,755,887,1114,1405,1692,1852,2576,3355,4104,4835,5498,6250,7280,7661,8390,9203,9756,9838},	
{432,440,476,500,573,662,808,950,1183,1474,1815,2388,2646,3430,4018,4602,5255,5869,6604,7558,7955,8627,9387,9811,9714},	
{503,524,636,718,1000,1246,1531,1854,2207,2696,3185,3622,3866,4509,4997,5482,5998,6539,7159,8075,8456,9125,9784,9767,9656},	
{911,1037,1532,1871,2555,3011,3463,3813,4109,4503,4913,5342,5540,5967,6309,6686,7077,7569,8092,8893,9481,9764,9721,9689,9933},	
{1375,1593,2312,2678,3290,3637,4045,4376,4675,5152,5510,5825,5944,6449,6809,7097,7423,7817,8324,9114,9409,9599,9542,9918,10000},	

//temp = 45 ^C

{346,347,361,372,415,446,489,535,591,561,633,916,1049,1392,1861,2777,3445,4477,5482,6597,7014,7816,8616,9340,9861},	
{323,329,352,369,404,430,460,491,534,622,854,1302,1421,1771,2244,3250,4198,5022,5875,6985,7376,8113,8947,9568,9862},
{320,330,365,388,448,500,574,668,779,962,1190,1444,1601,2327,3135,3921,4682,5366,6152,7222,7616,8361,9177,9719,9779},
{363,361,374,383,413,475,588,680,867,1089,1383,1931,2192,3004,3638,4284,5007,5673,6457,7475,7887,8580,9341,9750,9600},
{416,423,499,548,755,953,1185,1462,1773,2206,2654,3056,3328,4079,4637,5161,5733,6324,6994,7973,8374,9069,9725,9671,9514},	
{726,828,1252,1538,2138,2535,2918,3216,3482,3859,4316,4798,5017,5510,5911,6335,6769,7309,7882,8747,9355,9650,9577,9528,9741},	
{1072,1257,1869,2164,2659,2937,3316,3640,3945,4529,4910,5249,5374,6009,6446,6750,7097,7520,8064,8910,9214,9387,9296,9653,10000},
                                                  

//temp = 55 ^C

{330,332,348,360,404,435,478,522,576,543,613,893,1026,1367,1837,2755,3424,4458,5467,6586,7003,7803,8601,9322,9840},
{298,303,326,342,376,402,430,460,500,583,809,1249,1365,1709,2179,3188,4146,4979,5845,6969,7362,8100,8932,9549,9836},
{296,307,343,365,424,475,546,635,736,893,1088,1321,1474,2197,3019,3824,4601,5298,6104,7198,7598,8350,9168,9707,9758},
{336,330,334,335,345,393,489,551,707,878,1130,1652,1911,2735,3398,4088,4859,5560,6378,7436,7856,8562,9324,9727,9556},
{385,386,446,479,643,812,1004,1246,1528,1918,2331,2706,2994,3811,4415,4966,5576,6202,6905,7926,8337,9045,9700,9631,9455},
{646,737,1125,1380,1928,2288,2623,2874,3099,3442,3922,4440,4673,5218,5662,6120,6586,7160,7767,8672,9291,9591,9503,9445,9641},
{933,1099,1649,1898,2305,2526,2860,3162,3463,4117,4514,4868,5000,5733,6223,6543,6908,7352,7919,8799,9108,9273,9164,9512,9903},

};			


parameter_data_t parameter_customer;

/*****************************************************************************
 * Description:
 *		bmu_init_chip
 * Parameters:
 *		description for each argument, new argument starts at new line
 * Return:
 *		what does this function returned?
 *****************************************************************************/
void bmu_init_parameter(struct i2c_client *client)
{
	parameter_customer.config = &config_data;
	parameter_customer.ocv = &ocv_data;
	parameter_customer.temperature = &cell_temp_data;
	parameter_customer.client = client;
	parameter_customer.ocv_data_num = OCV_DATA_NUM;
	parameter_customer.cell_temp_num = TEMPERATURE_DATA_NUM;
	parameter_customer.charge_pursue_step = 10;		
 	parameter_customer.discharge_pursue_step = 6;		
	parameter_customer.discharge_pursue_th = 10;
	parameter_customer.wait_method = 2;


	//oz8806_cell_num = 2;
	//res_divider_ratio = 353 ;  // note: multiplied by 1000 

	//r1 = 220k,r2 = 120k,so 120 * 1000 / 120 + 220 = 353
	//r2's voltage is the voltage which oz8806 sample.
	
	//For example :
	//Read oz8806 voltage is vin
	//then the whole voltage is  vin * 1000 / res_divider_ratio;
}


/*****************************************************************************
 * Description:
 *		bmu_init_gg
 * Parameters:
 *		description for each argument, new argument starts at new line
 * Return:
 *		what does this function returned?
 *****************************************************************************/
void bmu_init_gg(void)
{
	gas_gauge->charge_table_num = CHARGE_DATA_NUM;
	gas_gauge->rc_x_num = XAxis;
	gas_gauge->rc_y_num = YAxis;
	gas_gauge->rc_z_num = ZAxis;

	gas_gauge->discharge_current_th = DISCH_CURRENT_TH;
	gas_gauge->ri = 0;
}










