/*****************************************************************************
* Copyright(c) O2Micro, 2013. All rights reserved.
*	
* O2Micro OZ8806 battery gauge driver
* File: parameter.c

* Author: Eason.yuan
* $Source: /data/code/CVS
* $Revision: 4.00.01 $
*
* This program is free software and can be edistributed and/or modify
* it under the terms of the GNU General Public License version 2 as
* published by the Free Software Foundation.
*	
* This Source Code Reference Design for O2MICRO OZ8806 access (\u201cReference Design\u201d) 
* is sole for the use of PRODUCT INTEGRATION REFERENCE ONLY, and contains confidential 
* and privileged information of O2Micro International Limited. O2Micro shall have no 
* liability to any PARTY FOR THE RELIABILITY, SERVICEABILITY FOR THE RESULT OF PRODUCT 
* INTEGRATION, or results from: (i) any modification or attempted modification of the 
* Reference Design by any party, or (ii) the combination, operation or use of the 
* Reference Design with non-O2Micro Reference Design.
*****************************************************************************/

#include <linux/kernel.h>
#include <linux/module.h>
#include <linux/i2c.h>
#include "parameter.h"

/*****************************************************************************
* Define section
* add all #define here
*****************************************************************************/
//#define OCV_DATA_NUM  11


/****************************************************************************
* extern variable declaration section
****************************************************************************/
extern int32_t res_divider_ratio;
extern uint8_t oz8806_cell_num;

/*****************************************************************************
* Global variables section - Exported
* add declaration of global variables that will be exported here
* e.g.
*	int8_t foo;
****************************************************************************/

one_latitude_data_t ocv_data[OCV_DATA_NUM] = {
	{3400, 00},{3500, 0}, {3668, 5}, {3700, 12},{3716, 15},{3732, 17},{3748, 19},
	{3764, 22},{3780, 27},{3796, 35},{3812, 40},{3828, 44},{3844, 47},{3860, 50},
	{3876, 53},{3892, 55},{3908, 56},{3924, 58},{3940, 60},{3956, 62},{3972, 64},
	{3988, 66},{4004, 68},{4020, 69},{4036, 71},{4052, 72},{4068, 74},{4084, 76},
	{4100, 77},{4116, 79},{4132, 80},{4148, 82},{4164, 83},{4180, 85},{4196, 86},
	{4212, 88},{4235, 90},{4240, 92},{4250, 93},{4260, 95},{4270, 96},{4280, 98},
	{4290, 99},{4300, 100},
};

// changle
one_latitude_data_t	charge_data[CHARGE_DATA_NUM] = {                                                                                                               
	{100, 10000},{158, 9989},{163, 9988},{169, 9987},{172, 9986},{178, 9965},{183,9943},
	{189, 9921},{198, 9882},{201, 9873},{207, 9847},{213, 9825},{219, 9803},{225, 9777},
	{233, 9747},{239, 9725},{247, 9694},{254, 9668},{262, 9638},{269, 9612},{278, 9577},
	{295, 9507},{313, 9429},{333, 9410},{353,9409},{375, 9400},{399, 9380},{424, 9350},
	{450, 9259},{479, 9163},{509, 9063},{539, 8967},{556, 8910},{574, 8854},{590, 8801},
	{626, 8684},{665, 8557},{706, 8409},{749, 8350},{770, 8300},{794, 8280},{816, 8250},
	{840, 8248},{864, 8174},{889, 8091},{914, 8013},{938, 7943},{965, 7856},{991, 7747},
	{1018, 7686},{1044, 7599},
};


one_latitude_data_t			cell_temp_data[TEMPERATURE_DATA_NUM] = {                                                                                                               
			{681,   115}, {766,   113}, {865,   105},
			{980,   100}, {1113,   95}, {1266,   90},
			{1451,   85}, {1668,   80}, {1924,   75},
			{2228,   70}, {2588,   65}, {3020,   60},
			{3536,   55}, {4160,   50}, {4911,   45},
			{5827,   40}, {6940,   35}, {8313,   30},
			{10000,  25}, {12090,  20}, {14690,  15},
			{17960,  10}, {22050,   5},	{27280,   0},
			{33900,  -5}, {42470, -10}, {53410, -15},
			{67770, -20},
};


config_data_t config_data = {20,232000,3300,5,781,250,3089,4350,160,3500,0,1};
//config_data_t config_data = {20,232000,3300,5,781,250,6850,4200,100,3500,0,1};

//
//config_data_t config_data = {22,232000,3300,5,781,250,6858,2100,100,1750,0,1};

/*
	int32_t		fRsense;		//= 20;			//Rsense value of chip, in mini ohm
	int32_t     temp_pull_up;  //230000;
	int32_t     temp_ref_voltage; //1800;1.8v
	int32_t		dbCARLSB;		//= 5.0;		//LSB of CAR, comes from spec
	int32_t		dbCurrLSB;		//781 (3.90625*100);	//LSB of Current, comes from spec
	int32_t		fVoltLSB;		//250 (2.5*100);	//LSB of Voltage, comes from spec

	int32_t		design_capacity;	//= 7000;		//design capacity of the battery
 	int32_t		charge_cv_voltage;	//= 4200;		//CV Voltage at fully charged
	int32_t		charge_end_current;	//= 100;		//the current threshold of End of Charged
	int32_t		discharge_end_voltage;	//= 3550;		//mV
	int32_t     board_offset;			//0; 				//mA, not more than caculate data
	uint8_t     debug;                                          // enable or disable O2MICRO debug information
}
*/



//  
int	XAxisElement[XAxis] = {3300,3320,3360,3395,3435,3475,3505,3530,3555,3580,3600,3630,
							3655,3680,3720,3750,3780,3810,3840,3885,3935,3980,4015,4060,4300};	
 

//int	YAxisElement[YAxis] = { 150,300,800,1000,1500,1600};	//real current mA.
//int	YAxisElement[YAxis] = { 167,334,835,1336,1670,2004};	//real current mA for huawei.
int	YAxisElement[YAxis] = { 200,400,600,800,1000,1300,1586};

                  
// RC table Z Axis value, in 10*'C format
int	ZAxisElement[ZAxis] = { -70,-50,50,150,250,350,450,550};

// contents of RC table, its unit is 10000C, 1C = DesignCapacity
//AE table
int	RCtable[YAxis*ZAxis][XAxis]={
//temp = -7.5 ^C

{1476,1594,1869,2179,2602,3097,3444,3784,4124,4499,4797,5245,5581,5881,6359,6656,6950,7238,7525,7888,8287,8652,8907,9252,10000},
{2547,2768,3279,3784,4362,4942,5377,5678,6038,6333,6554,6912,7141,7421,7787,8016,8295,8568,8838,9173,9482,9690,9787,9859,10000},
{3773,4082,4621,5057,5586,6107,6509,6741,7042,7265,7467,7767,7981,8256,8642,8927,9200,9391,9555,9709,9817,9870,9898,10000,10000},
{5727,5961,6400,6770,7160,7545,7830,8040,8245,8440,8604,8833,9006,9167,9413,9563,9681,9773,9843,9924,9988,10000,10000,10000,10000},
{6914,7104,7475,7782,8113,8428,8675,8865,9034,9203,9320,9477,9585,9674,9777,9836,9885,9928,9968,9996,10000,10000,10000,10000,10000},
{8216,8361,8644,8880,9151,9397,9563,9654,9722,9771,9801,9846,9876,9906,9953,9981,9995,10000,10000,10000,10000,10000,10000,10000,10000},
{10000,10000,10000,10000,10000,10000,10000,10000,10000,10000,10000,10000,10000,10000,10000,10000,10000,10000,10000,10000,10000,10000,10000,10000,10000},

//temp = -5 ^C

{1476,1594,1869,2179,2602,3097,3444,3784,4124,4499,4797,5245,5581,5881,6359,6656,6950,7238,7525,7888,8287,8652,8907,9252,10000},
{2547,2768,3279,3784,4362,4942,5377,5678,6038,6333,6554,6912,7141,7421,7787,8016,8295,8568,8838,9173,9482,9690,9787,9859,10000},
{3773,4082,4621,5057,5586,6107,6509,6741,7042,7265,7467,7767,7981,8256,8642,8927,9200,9391,9555,9709,9817,9870,9898,10000,10000},
{5727,5961,6400,6770,7160,7545,7830,8040,8245,8440,8604,8833,9006,9167,9413,9563,9681,9773,9843,9924,9988,10000,10000,10000,10000},
{6914,7104,7475,7782,8113,8428,8675,8865,9034,9203,9320,9477,9585,9674,9777,9836,9885,9928,9968,9996,10000,10000,10000,10000,10000},
{8216,8361,8644,8880,9151,9397,9563,9654,9722,9771,9801,9846,9876,9906,9953,9981,9995,10000,10000,10000,10000,10000,10000,10000,10000},
{10000,10000,10000,10000,10000,10000,10000,10000,10000,10000,10000,10000,10000,10000,10000,10000,10000,10000,10000,10000,10000,10000,10000,10000,10000},


//temp = 5 ^C

{1013,1042,1104,1173,1277,1429,1601,1814,2075,2373,2643,3085,3573,4181,5025,5533,5975,6354,6672,7143,7596,7958,8279,8660,10000},
{1302,1392,1594,1821,2151,2562,2951,3312,3721,4133,4475,4960,5332,5682,6204,6544,6870,7173,7445,7815,8241,8622,8902,9250,10000},
{2272,2466,2824,3249,3748,4281,4732,5080,5428,5729,6002,6321,6598,6862,7227,7504,7759,7990,8208,8568,8951,9275,9520,9793,10000},
{2980,3218,3737,4210,4734,5263,5676,5977,6272,6547,6760,7065,7302,7525,7879,8117,8350,8578,8803,9114,9433,9698,9862,9968,10000},	
{3299,3568,4266,4779,5378,5776,5824,6104,6378,6644,6856,7169,7417,7648,8011,8263,8525,8752,8960,9248,9500,9658,9737,10000,10000},
{4736,5123,6208,6705,7474,7976,6575,6822,7070,7313,7500,7776,7996,8211,8534,8772,8973,9146,9291,9469,9614,9703,9754,9796,10000},
{6842,7229,8237,8734,9213,9369,9244,9117,9213,9054,9250,9451,9681,9680,9624,9900,10000,10000,10000,10000,10000,10000,10000,10000,10000},	


//temp = 15 ^C

{729,746,783,819,868,925,977,1032,1108,1228,1418,1999,2285,2655,3756,4503,5122,5633,6025,6486,7025,7431,7745,8171,10000},
{687,713,767,823,913,1040,1201,1402,1713,2045,2323,2839,3387,4003,4844,5356,5792,6176,6520,6987,7438,7838,8161,8548,10000},
{1094,1136,1231,1353,1573,1870,2199,2570,2914,3396,3733,4363,4781,5223,5789,6175,6522,6860,7158,7543,7972,8352,8639,8989,10000},
{1082,1154,1337,1557,1925,2425,2907,3320,3764,4230,4584,5053,5415,5756,6272,6612,6945,7242,7502,7882,8317,8681,8954,9302,10000},
{1518,1648,1945,2284,2867,3462,4000,4446,4765,5137,5437,5820,6095,6390,6860,7144,7407,7666,7923,8313,8682,9027,9293,9610,10000},
{2313,2535,3054,3566,4174,4767,5205,5527,5834,6140,6357,6682,6932,7183,7547,7793,8038,8289,8520,8859,9214,9528,9752,9925,10000},
{3709,3959,4655,5031,5624,5892,6235,6442,6661,6895,7166,7444,7540,7787,8036,8268,8568,8862,9244,9770,9900,10000,10000,10000,10000},
                                                                                                        

//temp = 25 ^C

{607,623,655,689,733,783,828,870,918,975,1047,1468,2012,2289,3227,4109,4802,5366,5798,6250,6805,7252,7571,8005,9999},
{518,537,577,616,669,733,795,862,969,1202,1665,2071,2475,3159,4280,4884,5404,5842,6189,6687,7193,7600,7938,8337,10000},
{778,801,848,898,969,1073,1206,1414,1783,2154,2436,3064,3720,4285,5057,5529,5945,6313,6648,7106,7555,7955,8253,8628,10000},
{625,652,718,792,917,1143,1471,1836,2223,2717,3194,3915,4419,4878,5522,5928,6308,6662,6976,7393,7853,8246,8538,8907,10000},
{813,851,948,1076,1311,1727,2193,2660,3178,3727,4153,4700,5104,5470,6024,6389,6736,7047,7322,7736,8166,8531,8813,9164,10000},
{1052,1118,1309,1569,2030,2745,3397,3914,4386,4817,5144,5560,5899,6226,6694,7021,7307,7582,7847,8244,8644,9004,9264,9600,10000},
{2036,2310,3201,3671,4416,4831,5216,5507,5784,6095,6419,6699,6815,7150,7403,7679,7989,8342,8796,9492,9771,9993,10000,10000,10000},
                                                                                 
//temp = 35 ^C
{521,535,567,600,643,692,735,775,819,869,915,1056,1838,2091,2813,3696,4471,5101,5607,6061,6608,7118,7459,7903,10000},
{370,378,407,427,468,497,1075,1118,1167,1232,1333,1879,2265,2580,3505,4453,5087,5613,5997,6505,7072,7521,7816,8259,10000},
{374,387,426,451,517,572,920,974,1063,1266,1607,2088,2436,3020,4119,4784,5299,5746,6128,6629,7136,7540,7863,8250,10000},
{432,440,476,500,573,662,992,1118,1372,1789,2068,2537,3184,3849,4678,5164,5679,6062,6416,6899,7357,7760,8056,8430,10000},
{503,524,636,718,1000,1246,1525,1788,2166,2525,2871,3590,4205,4712,5407,5838,6266,6622,6964,7417,7867,8245,8518,8698,10000},
{911,1037,1532,1871,2555,3011,1889,2277,2754,3311,3788,4405,4844,5237,5789,6196,6542,6879,7173,7585,8005,8375,8646,8987,10000},
{1375,1593,2312,2678,3290,3637,4045,4376,4675,5152,5510,5825,5944,6449,6809,7097,7423,7817,8324,9114,9409,9599,9542,9918,10000},	

//temp = 45 ^C

{557,572,605,638,682,733,777,817,863,914,961,1091,1886,2142,2903,3628,4449,5098,5619,6052,6608,7133,7487,7936,10000},
{500,516,552,589,637,694,742,788,840,907,1046,1837,2103,2550,3633,4390,5004,5520,5875,6351,6936,7398,7744,8163,10000},
{580,598,637,677,730,793,847,901,980,1286,1837,2173,2637,3302,4332,4923,5439,5848,6175,6688,7228,7663,7994,8395,10000},
{595,615,660,705,765,838,910,1031,1451,1943,2177,2758,3489,4134,4936,5438,5863,6220,6563,7059,7545,7971,8283,8671,10000},
{624,648,702,758,838,989,1409,1901,2213,2710,3298,4069,4589,5033,5650,6049,6415,6758,7078,7509,7975,8371,8671,9046,10000},
{641,666,727,793,906,1258,1785,2139,2607,3299,3822,4455,4908,5307,5874,6265,6627,6963,7267,7686,8133,8514,8804,9171,10000},	
{1072,1257,1869,2164,2659,2937,3316,3640,3945,4529,4910,5249,5374,6009,6446,6750,7097,7520,8064,8910,9214,9387,9296,9653,10000},
                                                  

//temp = 55 ^C

{330,332,348,360,404,435,478,522,576,543,613,893,1026,1367,1837,2755,3424,4458,5467,6586,7003,7803,8601,9322,9840},
{298,303,326,342,376,402,430,460,500,583,809,1249,1365,1709,2179,3188,4146,4979,5845,6969,7362,8100,8932,9549,9836},
{296,307,343,365,424,475,546,635,736,893,1088,1321,1474,2197,3019,3824,4601,5298,6104,7198,7598,8350,9168,9707,9758},
{336,330,334,335,345,393,489,551,707,878,1130,1652,1911,2735,3398,4088,4859,5560,6378,7436,7856,8562,9324,9727,9556},
{385,386,446,479,643,812,1004,1246,1528,1918,2331,2706,2994,3811,4415,4966,5576,6202,6905,7926,8337,9045,9700,9631,9455},
{646,737,1125,1380,1928,2288,2623,2874,3099,3442,3922,4440,4673,5218,5662,6120,6586,7160,7767,8672,9291,9591,9503,9445,9641},
{933,1099,1649,1898,2305,2526,2860,3162,3463,4117,4514,4868,5000,5733,6223,6543,6908,7352,7919,8799,9108,9273,9164,9512,9903},

};			


parameter_data_t parameter_customer;

/*****************************************************************************
 * Description:
 *		bmu_init_chip
 * Parameters:
 *		description for each argument, new argument starts at new line
 * Return:
 *		what does this function returned?
 *****************************************************************************/
void bmu_init_parameter(struct i2c_client *client)
{
	parameter_customer.config = &config_data;
	parameter_customer.ocv = &ocv_data;
	parameter_customer.temperature = &cell_temp_data;
	parameter_customer.client = client;
	parameter_customer.ocv_data_num = OCV_DATA_NUM;
	parameter_customer.cell_temp_num = TEMPERATURE_DATA_NUM;
	parameter_customer.charge_pursue_step = 10;		
 	parameter_customer.discharge_pursue_step = 6;		
	parameter_customer.discharge_pursue_th = 10;
	parameter_customer.wait_method = 2;


	//oz8806_cell_num = 2;
	//res_divider_ratio = 353 ;  // note: multiplied by 1000 

	//r1 = 220k,r2 = 120k,so 120 * 1000 / 120 + 220 = 353
	//r2's voltage is the voltage which oz8806 sample.
	
	//For example :
	//Read oz8806 voltage is vin
	//then the whole voltage is  vin * 1000 / res_divider_ratio;
}


/*****************************************************************************
 * Description:
 *		bmu_init_gg
 * Parameters:
 *		description for each argument, new argument starts at new line
 * Return:
 *		what does this function returned?
 *****************************************************************************/
void bmu_init_gg(void)
{
	gas_gauge->charge_table_num = CHARGE_DATA_NUM;
	gas_gauge->rc_x_num = XAxis;
	gas_gauge->rc_y_num = YAxis;
	gas_gauge->rc_z_num = ZAxis;

	gas_gauge->discharge_current_th = DISCH_CURRENT_TH;
}










